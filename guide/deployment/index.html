<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Deployment - Kubernetes Introduction</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/favicon.png><link rel=stylesheet href=/VIA-Kubernetes-Introduction/css/style.min.e0a2ab335854ea3265fd2ea419dc847fab383c2485602b9c47c3a9eb7c4ffce7.css></head><body class="page page-default-single"><div id=main-menu-mobile class=main-menu-mobile><ul><li class=menu-item-home><a href=/VIA-Kubernetes-Introduction/><span>Home</span></a></li><li class=menu-item-guide><a href=/VIA-Kubernetes-Introduction/guide/><span>Guide</span></a></li></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/><img alt=Logo src=/VIA-Kubernetes-Introduction/images/logo.svg></a></div><div class=logo-mobile><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/><img alt=Logo src=/VIA-Kubernetes-Introduction/images/logo-mobile.svg></a></div><div id=main-menu class=main-menu><ul><li class=menu-item-home><a href=/VIA-Kubernetes-Introduction/><span>Home</span></a></li><li class=menu-item-guide><a href=/VIA-Kubernetes-Introduction/guide/><span>Guide</span></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pt-md-6 pb-3 pb-md-6"><div class=row><div class="col-12 col-md-3 mb-3"><div class=sidebar><div class=docs-menu><h4>Guide</h4><ul><li><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/setup/>Installation</a></li><li><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/containers/>Containers</a></li><li><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/pod/>Pods</a></li><li class=active><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/deployment/>Deployment</a></li><li><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/service/>Service</a></li><li><a href=https://lukaspj.github.io/VIA-Kubernetes-Introduction/guide/configure/></a></li></ul></div></div></div><div class="col-12 col-md-9"><h1 class=title>Deployment</h1><div class=content><p><a href=../pod>Creating a pod</a> is cool, but it&rsquo;s not that different from just
running the Docker container by hand. Let&rsquo;s try doing something
slightly more sophisticated.</p><p>We&rsquo;ll create a Deployment<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> which is a &ldquo;controller&rdquo; that manages
your pods.</p><p>It follows the same basic structure as the Pod YAML but its spec
is significantly more complicated:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span></code></pre></div><p>So let&rsquo;s look into the <code>spec</code> first we have a <code>selector</code> which describes
how the deployment identifies its pods. In case you have multiple
deployments you don&rsquo;t want them to become confused, so you must always
specify a selector.</p><p>Now the <code>template</code> section is actually more or less just a pod YAML
without the <code>apiVersion</code> and <code>kind</code>. We have added a label that matches
the selector.</p><p>Now save this file as <code>deployment.yaml</code> and use it by running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml
</span></span></code></pre></div><p>Verify with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get deployment
</span></span></code></pre></div><p>It should return something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>❯ kubectl get deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                   READY   UP-TO-DATE   AVAILABLE   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pythonapp-deployment   1/1     1            1           10m</span><span class=w>
</span></span></span></code></pre></div><p>Now, why is this clever? Well, among other things deployments have a
field in their <code>spec</code> called &ldquo;replicas&rdquo; which you can set like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w> </span><span class=c># &lt;-- Add this line</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>pythonapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span></code></pre></div><p>And now <code>kubectl apply -f deployment.yaml</code> and verify with
<code>kubectl get deployment</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>❯ kubectl get deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                   READY   UP-TO-DATE   AVAILABLE   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pythonapp-deployment   3/3     3            3           12m</span><span class=w>
</span></span></span></code></pre></div><p>You can also try <code>kubectl get pod</code> and see the 3 pods that have been
created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>❯ kubectl get pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>NAME                                    READY   STATUS    RESTARTS   AGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pythonapp-deployment-695db994db-7s445   1/1     Running   0          49s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pythonapp-deployment-695db994db-989j6   1/1     Running   0          9m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>pythonapp-deployment-695db994db-sfxlh   1/1     Running   0          49s</span><span class=w>
</span></span></span></code></pre></div><p>You can also change the scale directly with the <code>scale</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>kubectl scale deployment/pythonapp-deployment --replicas=5</span><span class=w>
</span></span></span></code></pre></div><p>However, now we have an issue.. We have multiple pods and if we want to
talk to all of them we can&rsquo;t just use <code>kubectl port-forward</code> because then
we&rsquo;d have to forward once for each pod and it would be on different ports.</p><p>We&rsquo;ll cover a solution for this in the <a href=../service>Service topic</a>.</p><p>You can delete the deployment again to clean up, but don&rsquo;t do it yet!
You&rsquo;ll need it for the <a href=../service>Service topic</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>kubectl delete deployment/pythonapp-deployment</span><span class=w>
</span></span></span></code></pre></div><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/>https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div></div></div></div></div><div class=sub-footer><div class=container><div class=row><div class=col-12><div class=sub-footer-inner><ul><li class=zerostatic><a href=https://www.zerostatic.io>www.zerostatic.io</a></li></ul></div></div></div></div></div><script type=text/javascript src=/VIA-Kubernetes-Introduction/js/scripts.min.55e8e1e2e7596c9a982bc04119cee1e2d4624c4c5a2dc0e9eb63ce401be14a24.js></script></body></html>